# 第1章 概述

## 1.1 体系结构原则

- Internet体系结构在一些目标的指导下建立
- 目前有几种被广泛接受的设计方案

### 1.1.1 分组、连接和数据报

#### 1.1.1.1 连接

#### 1.1.1.2 带宽

#### 1.1.1.3 分组

#### 1.1.1.4（多路）复用

##### 1.1.1.4.1 多路复用是什么？

- 来自不同源的分组可以组合，以后也可以分解
- 有没有实际的场景？？？

##### 1.1.1.4.2 处理分组的调度方式

- 先到先服务/先进先出（FCFS/FIFO）
- 统计复用###
- 时分复用（TDM）和静态复用###
- 数字用户线（DSL）技术###
- 支持Internet连接的电缆调制解调器###（第三章）

##### 1.1.1.4.3 联网方式是否面向连接

- 面向连接
- 数据报
- 消息边界
  - 大多数数据报协议保存消息边界
  - 在电路交换或虚电路网络中，不保留消息边界
  - 底层协议不保留消息边界
  - 应用程序在需要的时候自己提供这个功能

### 1.1.2 端到端论点和命运共享

- 设计一个大型系统时，应当考虑在哪里实现相应的功能（是底层协议还是应用程序）
- 如图1-1的例子，保留发送方的消息边界这个功能应该在哪里实现

#### 1.1.2.1 端到端论点

- 重要功能通常不会在底层实现，而应当在端主机的应用程序中实现

#### 1.1.2.2 命运共享

- 按照端到端论点，重要功能应当在端主机的应用程序中实现
- 哪些功能应当放到同一个端主机/网络/软件栈中实现？

- 命运共享协议建议将所有必要的状态放在通信端点？？？

### 1.1.3 差错控制和流量控制

## 1.2 设计和实现

- 目前的常用方案都是分层思想

### 1.2.1 分层

- 每层只负责通信的一个方面
- 目前主流的分层模型有OSI七层模型和TCP/IP五层结构
- OSI七层模型见图1-2

### 1.2.2 分层实现中的复用、分解和封装

- 复用
  - 复用指的是同一基础设施（主机）中，不同层之间对同一信息的复用
  - 每层都有不同类型的表示符，添加到信息中，用于确定信息属于哪个协议或信息流
- 协议数据单元（PDU）
- 封装
  - 理解成打包解包的过程
  - 当某层的一个PDU被低层携带时，这个过程称为在相邻低层的封装（从高层到低层逐层打包）
  - 每层都有自己的PDU，而且不会查看上层的PDU（不透明），这就是封装的本质
- 不是所有的设备都需要实现所有层
  - 例子见图1-4
  - 在理想化的情况下，交换机和路由器并不需要应用程序，所以没有应用层
  - 实际情况下，交换机和路由器有时候需要充当主机，所以会实现传输层和应用层协议
- 端系统和中间系统，端到端协议和逐跳协议
  - 网络层之上的各层使用端到端协议，只有端系统需要这些层
    - 中间系统通常不会实现网络层之上的层，因为没有必要
  - 网络层提供了逐跳协议，用于两个端系统和每个中间系统
    - 以路由器为例，它要负责到下一跳，这是网络层实现的，所以要关心下一跳
  - 通常不认为交换机或桥接是一个中间系统
    - 它们没采用互联网协议的地址格式来编址
    - 路由器和端系统通常是感觉不到它们的存在的
- 路由器
  - 有两个或多个网络接口（因为至少连接两个网络）
  - 有多个接口的系统称为多宿主
  - 如果一台多宿主主机专门负责将分组从一个接口转发到另一个接口，那么它充当了路由器的功能
- 应用层并不关心物理拓扑和低层协议

## 1.3 TCP/IP协议族结构和协议

- Internet使用的协议集或协议族，包括TCP/IP协议族和一些TCP/IP之外的协议

### 1.3.1 ARPANET参考模型

- 最终被TCP/IP协议族采纳
- 结构比OSI七层模型简单

- 协议分层结构见图1-5
  - 层次2.5
    - ARP协议在这层
    - ARP只用于多接入链路层协议，完成IP地址和链路层使用的地址（MAC地址）之间的转换
    - 详细在第4章
  - 层次3
    - IP协议在这层
    - 第5章讨论IP协议的细节
    - 第10章讨论分片
    - 第2章介绍IP地址格式和三种类型的IP地址
  - 3.5层
    - Internet控制消息协议（ICMP）和INternet组管理协议（IGMP）在这层
    - 诊断工具ping使用的就是ICMP
    - ICMP消息被封装在IP数据报
    - 封装方式和传输层的PDU相同
    - 第9章介绍IGMP和组播监听发现（MLD）协议
  - 4层
    - 常见的两种传输协议TCP和UDP
    - 数据报拥塞控制协议（DCCP），第16章
    - 流控制传输协议（SCTP）
  - 5层
    - 应用层不关心低层的细节，只关心应用的细节
    - 较低的3层则相反

### 1.3.2 TCP/IP中的复用、分解和封装

- 和1.2.2一样，理解成打包解包的过程
- 在一台主机上的分解过程见图1-6
- 注意每一层根据PDU的协议类型字段，选择上一层使用的协议
  - 网络层用IP协议进行处理的时候，有可能会发现协议字段的值是4或者41，这表明这次的IP数据报的有效载荷是另一个IP数据报，者违反了分层和封装的原则，但是这是合理的，是隧道技术的基础，第3章、
- 在传输层中，大部分协议通过端口号将复用分解到相应的应用？？？

### 1.3.3 端口号

#### 1.3.3.1 端口号范围

- 16位，0~65535

#### 1.3.3.2 端口号和建立连接的关系

- 服务器先”绑定“到一个端口号，然后一个或多个客户机可使用某种传输协议与服务器上的端口号建立连接

#### 1.3.3.3 分配机构

- Internet号码分配机构（IANA）

#### 1.3.3.4 端口号的种类

- 熟知端口号
  - 服务器需要绑定到熟悉端口号
  - 一些众所周知的服务使用的熟悉端口号
- 注册端口号
  - 提供给有特殊权限的客户机或服务器
  - 开发新应用时应尽量避免使用注册端口号
- 动态/私有/临时端口号
  - 很多时候无关紧要，因为只是短期被使用

### 1.3.4 名称、地址和DNS

- 第11章

### 1.4 Internet、内联网和外联网

- Iinternet是由很多网络互联起来的网络集合
  - 组网
  - 由路由器连接多个网络的互联网络
- 内联网、外联网和VPN
  - 第7章

## 1.5 设计应用

### 1.5.1 服务模型（什么是服务）

- 在不同（或相同）计算机上的程序之间传输数据

### 1.5.2 当前网络应用的几种模式

#### 1.5.2.1 客户机/服务器

- 这里的客户机和服务器表示应用程序，而非应用所运行的计算机系统，有可能一个服务器（硬件）上运行多个服务器（应用）

##### 1.5.2.1.1 迭代服务器

- 类似于阻塞模型
- 存在的问题是，阻塞的时间内，无法未其它客户机提供服务

##### 1.5.2.1.2 递归服务器

- 和c的listen, accept类似

#### 1.5.2.2 对等

- 分布式的设计，每个应用既是客户机，又是服务器，有时候又同时是两者（可以提供服务也可以转发请求）
- 覆盖网络
- 发现服务
  - 一个对等方需要在网络中发现，提供它所需的数据或服务的其它对等方
  - 通常由引导程序来处理，以便每个客户机在最初配置中使用所需要的对等方的地址和端口号

## 1.6 标准化进程

### 1.6.1 RFC

### 1.6.2 其它标准

## 1.7 实现和软件分发

### 1.8 与Internet体系结构相关的攻击

- 欺骗

  - Internet体系结构交付IP数据报是基于目的IP地址，因此无法确定接收到的数据报来源
  - 在IP数据报的源地址字段中可以填入任何IP地址
  - 欺骗可以与各种攻击相结合

- 拒绝服务（DoS）攻击

  - 向一台服务器发送大量IP数据报，使它花费大量时间处理这些无用数据报

  - 这通常需要很多计算机来发送，形成一个分布式DoS（DDoS）攻击

- 未授权访问攻击 ###

- 加密
  - 第18章